<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VueTube</title>
    <link rel="icon" type="image/x-icon" href="static/favicon.ico">
    <link href="bootstrap/bootstrap-5.3.0.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="bootstrap/bootstrap-5.3.0.bundle.min.js"
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
            crossorigin="anonymous"></script>
    <script
            src="bootstrap/jquery-3.3.1.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
            crossorigin="anonymous">
    </script>
</head>
<body>
<br>
<div class="container">

    <div id="header"></div>


    <div class="row" id="results">
        <img id="loadingGIF" src="static/loading.gif">
    </div>

    <div id="footer"></div>
</div>
</body>


<script>

    //TODO https://api.datamuse.com/words?sp=b*&max=10 autocomplete api
    $(function () {
        $("#footer").load("footer.html");
        $("#header").load("header.html");
    });

    function call(query) {
        document.getElementById('searchInput').blur()
        var search = document.getElementById('searchInput').value
        if (query != undefined)
            search = query
        if (search == undefined || search == "")
            return

        document.getElementById("results").innerHTML = '<img id="loadingGIF" src="static/loading.gif">'

        // Make an HTTP GET request to the YouTube Data API search endpoint
        var apiKey = ""
        var apiKey1 = 'AIzaSyB5LG4TFaO95eqkE6yRBgJgr0egwSBSy8U'
        var apiKey2 = 'AIzaSyD1HX-in66XEtm57Ig6S2JJDQ56uXr5c2s'
        var apiKey3 = 'AIzaSyAdv9_oNyCgRE_coy3QYLlIG05bBqznx80'
        var num = Math.random()
        if (num < 0.33)
            apiKey = apiKey1
        else if (num < 0.66)
            apiKey = apiKey2
        else apiKey = apiKey3
        var q = []
        fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${search}&key=${apiKey}&maxResults=20`) // maxResults=50
            .then(response => response.json())
            .then(data => {
                console.log(data)
                // Iterate over the retrieved videos
                data.items.forEach((item, i) => {

                    var obj = {
                        isChannel: false,
                        title: item.snippet.title,
                        thumbnailUrl: item.snippet.thumbnails.high.url,
                        publishedAt: item.snippet.publishedAt
                    }
                    if (item.id.kind === "youtube#channel") {
                        obj.isChannel = true
                        obj.channelURL = `https://www.youtube.com/channel/${item.id.channelId}`
                        obj.publishedAt = 'Channel'
                    } else {
                        obj.watch = item.id.videoId
                        obj.videoURL = `https://www.youtube.com/watch?v=${item.id.videoId}`;
                        obj.channelURL = `https://www.youtube.com/channel/${item.snippet.channelId}`
                        obj.chTitle = item.snippet.channelTitle;
                    }
                    if (obj.isChannel || (!obj.isChannel && obj.watch !== undefined)) {
                        q.push(obj)
                    }

                });
            })
            .catch(error => {
                console.error('Error:', error);
            });

        setTimeout(function () {
            text = ""
            for (let x in q) {
                var vidLink = ""
                var end = ""
                var isVideo = ""
                var chLink = ""
                var openVideo = "view.html?watch=" + q[x].watch
                if (!q[x].isChannel) {

                    isVideo = 'Channel: <a class="text-decoration-none " target="_blank" href="' + q[x].channelURL + '">' + q[x].chTitle + '</a>'
                    vidLink = '<a class="text-decoration-none " href="' + openVideo + '">' //q[x].videoURL
                    end = "</a>"
                } else {
                    chLink = '<a class="text-decoration-none " target="_blank" href=" ' + q[x].channelURL + '">'
                    end = "</a>"
                }


                text += '<div class="col mb-4">\n' +
                    '            <div class="card" style="width: 18rem;">\n' +
                    '                ' + vidLink + '<img src="' + q[x].thumbnailUrl + '" class="card-img-top" alt="...">' + end + '\n' +
                    '                <div class="card-body cb-1">\n' +
                    '<div>' +
                    '                    ' + vidLink + chLink + '<h5 class="card-title">' + q[x].title + '</h5>' + end + '\n' +
                    isVideo +
                    '</div>' +
                    '                    <p class="card-text text-end">' + q[x].publishedAt.slice(0, 10) + '</p>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>'


                document.getElementById("results").innerHTML = text

            }

        }, 800)
    }

    setTimeout(() => {
        document.getElementById("bt1").onclick = function () {
            call()
        }
    }, 100)


    function focusFunc() {
        var input = document.getElementById("searchInput");
        input.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                call()
            }
        });
    }


    // initial call index page
    setTimeout(() => {
        call("programming")
    }, 200)

</script>
<style>
    .hd1 a {
        text-decoration: none;

    }

    .hd1 {
        font-size: 2rem;
        color: blue;
        display: contents;
    }

    .col {
        text-align: -moz-center;
        text-align: -webkit-center;
    }

    .card {
        text-align: left;
        height: 100%;
    }

    .green {
        color: #42b883;
    }
    .cb-1{
        display: flex;
        justify-content: space-between;
        flex-direction: column;
    }
    #loadingGIF{
        width: 100px;
        margin-left: auto;
        margin-right: auto;
    }
</style>
</html>

